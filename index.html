<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pixi</title>
    <link rel="stylesheet" href="style.css">
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
<body>

<div id="slower">slower</div>
<div id="faster">faster</div>

<div id="more">more</div>
<div id="less">less</div>
<div id="howMuch"></div>
<script type="text/javascript">


    let pointX = 0
    let pointY = 0

    let gravity = 0.5

    let generated = 2000

    let arr = []

    let faster = document.getElementById('faster')
    let slower = document.getElementById('slower')

    let more = document.getElementById('more')
    let less = document.getElementById('less')

    function mousePositionGenerate(event) {
        pointX = event.clientX
        pointY = event.clientY
    }

    document.addEventListener("click", mousePositionGenerate);

    let type = "WebGL"
    if (!PIXI.utils.isWebGLSupported()) {
        type = "canvas"
    }

    PIXI.utils.sayHello(type)
    let app = new PIXI.Application({
        width: 300,         // default: 800
        height: 300,        // default: 600
        antialias: true,    // default: false
        transparent: false, // default: false
        resolution: 1
    });

    function onClickFast() {
        gravity = gravity + 0.5
    }

    faster.addEventListener("click", onClickFast);

    function onClickSlower() {
        if (gravity > 0.5) {
            gravity = gravity - 0.5
        }
    }

    slower.addEventListener("click", onClickSlower);

    let Container = new PIXI.Graphics();
    Container.lineStyle(0);
    Container.beginFill(0x000000);
    Container.drawRect(0, 0, 300, 300);
    Container.endFill();

    Container.interactive = true;
    Container.buttonMode = true;

    let generateFigure = (setX, setY) => {
        let which = Math.floor(Math.random() * Math.floor(4))

        let colors = [0x00FFFF, 0xFF0000, 0x00FF00, 0x0000FF];

        let colorIndex = Math.floor(Math.random() * Math.floor(4));

        switch (which) {
            case 0:
                let rectangle = new PIXI.Graphics();
                rectangle.lineStyle(0);
                rectangle.beginFill(colors[colorIndex]);
                rectangle.drawRect(0, 0, 30, 30);
                rectangle.endFill();
                rectangle.x = setX;
                rectangle.y = setY

                rectangle.interactive = true;
                rectangle.buttonMode = true;


            function onClick1() {
                app.stage.removeChild(rectangle);
            }

                rectangle.on('click', onClick1);

                app.stage.addChild(rectangle);

                arr.push(rectangle);

                break;
            case 1:

                let circle = new PIXI.Graphics();
                circle.lineStyle(0); // draw a circle, set the lineStyle to zero so the circle doesn't have an outline
                circle.beginFill(colors[colorIndex], 1);
                circle.drawCircle(0, 0, 15);
                circle.endFill();
                circle.x = setX;
                circle.y = setY

                circle.interactive = true;
                circle.buttonMode = true;

            function onClick2() {
                app.stage.removeChild(circle);
            }

                circle.on('click', onClick2);

                app.stage.addChild(circle);

                arr.push(circle);
                break;
            case 2:

                let ellipse = new PIXI.Graphics();
                ellipse.lineStyle(0);
                ellipse.beginFill(colors[colorIndex], 1);
                ellipse.drawEllipse(0, 0, 15, 20);
                ellipse.endFill();
                ellipse.x = setX;
                ellipse.y = setY

                ellipse.interactive = true;
                ellipse.buttonMode = true;

            function onClick3() {
                app.stage.removeChild(ellipse);
            }

                ellipse.on('click', onClick3);

                app.stage.addChild(ellipse);

                arr.push(ellipse);
                break;
        }
    }

    function onClickContainer(event) {
        console.log('>>>555555555', event.data.global)
        generateFigure(event.data.global.x, event.data.global.y)
    }

    Container.on('click', onClickContainer);

    app.stage.addChild(Container);

    let generateInterval = setInterval(() => {

        let setX = Math.random() * (265 - 5) + 2;

        generateFigure(setX, -40)

    }, generated)

    function onClickLes() {
        console.log('>>>',);
        generated = generated + 300
        clearInterval(generateInterval)

        generateInterval = setInterval(() => {

            let setX = Math.random() * (265 - 5) + 2;

            generateFigure(setX, -40)

        }, generated)
    }

    less.addEventListener("click", onClickLes);

    function onClickMore() {
        console.log('>>>!!!!',);
        if (generated > 600) {
            generated = generated - 300

            clearInterval(generateInterval)

            generateInterval = setInterval(() => {

                let setX = Math.random() * (265 - 5) + 2;

                generateFigure(setX, -40)

            }, generated)
        }
    }

    more.addEventListener("click", onClickMore);
    let howMuch = document.getElementById('howMuch')

    app.ticker.add((delta) => {
        let number = 0
        arr.forEach(item => {
            if (item.y < 330)
                item.y = item.y + gravity;

            if (300 > item.y > 0) {
                number = number + 1
            } else if (item.y == 300) {
                number = number - 1
            }
        })
        howMuch.innerText = number
    });


    document.body.appendChild(app.view);
</script>
</body>
</html>